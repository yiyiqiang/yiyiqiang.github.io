# 1. 【四种模式】

1. **命令模式**
    1. **sh 终端**：vim 命令
    2. **编辑模式**：ESC
    3. **末行模式**：连按两次 ESC
    4. **可视化模式**：ESC

    > * 命令模式下按相应命令可进入其它三个模式

2. **编辑模式**（插入模式）
    |命令|作用|命令|作用|
    | :-: | :-: | :-: | :-: |
    |`i`|光标前|`I`|行首 |
    |`o`|下一行|`O`|上一行|
    |`a`|光标后|`A`| 行末 |
    |`r`|替换当前字符|`R`| 连续替换与输入等长的内容|
    |`s`|删除当前字符|`S`| 删除当前行 |

    > * `c`：同 `d` 命令，只是删除后进入编辑模式

3. **末行模式**：`:`、`/`、`?`
4. **可视化模式**： `v`、`V`、`Ctrl + V`

# 2. 【打开与保存】
1. **学习工具**：`vimtutor`
    * `vimtutor`：默认英文版
    * `vimtutor -g zh`：使用中文版

2. **打开或新建文件**
    * `vim file`：打开/新建文件，光标置于第1行行首
    * `vim file +n`：打开文件，光标置于第n行行首
    * `vim file +`：打开文件，光标置于最后1行行首
    * `vim file +/pattern`：将光标置于与 pattern 匹配的第一个字符串处
    * `vim -r file`：恢复上次 vim 打开时崩溃的文件

3. **多标签**
    * `vim 文件1 文件2 文件N -p`
    * `vim -p *`：编辑当前目录下的所有文件
        * `:tabp` 或 `gT`：前一个
        * `:tabn` 或 `gt`：后一个
        * `:tabfir[st]`：第一个
        * `:tabl[ast]`：最后一个
        * `:tabm`：移动到最后
        * `:tabm 1`：将把当前标签页移动到第2的位置
        * `:tabc`：关闭当前的 tab
        * `:tabo`：关闭所有其他的 tab
        * `:tabs`：查看所有打开的 tab
        * `:tabnew <文件名>`：在新标签页中编辑新的文件
        * `:tabdo <命令>`：同时在多个标签页中执行命令
            * `:tabdo %s/food/drink/g`：把当前多个标签页文件中的“food”都替换成“drink”
        * `:help tab-page-intro`：获得关于标签页使用的更多信息

4. **保存退出文本**
    * `:wq`：保存并退出
    * `:wq!`：保存并强制退出
    * `:q`：不保存退出
    * `:q!`：不保存，且强制退出
    * `:w`：只保存
    * `:w!`：强制保存
    * `:x`：保存退出
    * `:w filename`：另存
    * `:n1,n2 w [filename]`：将n1到n2的内容储存成filename这个文件
    * `ZZ`：直接退出

    > `w!` 和 `wq!` 等类似指令，通常用于没有写权限时，文件所有者或者 root 用户可强制执行

# 3. 【移动光标】

1. **以字符为单位移动**：方向键 或 h、j、k、l

2. **移动至指定字符**
    * `fx`：移动至当前行中下一个 x 字符处
    * `Fx`：移动至当前行中上一个 x 字符处

3. **以单词为单位移动光标**
    * `w`：将光标移至下一个单词的词首
    * `e`：将光标移至当前或下一个单词的词尾
    * `b`：将光标移至当前或前一个单词的词首

3. **移动到行尾或者行首**
    * `^`  或  `0`：跳转到行首
    * `$`：跳转到行尾
    * `n$`：跳转到多行行尾（从当前行开始）

4. **移动到匹配的括号处**
    * 适用于 `()`、`[]`、`{}`
    * 将光标先定位在  `{` 处，然后再使用 ％ 命令，使之定位在  `}` 处
    * 再次按 % 就可以跳回配对的第一个括号处

5. **移动到指定行处**
    * `H`：光标移动到当前窗口最上方的那一行
    * `M`：光标移动到当前窗口中间的那一行
    * `L`：光标移动到当前窗口最下方的那一行
    * `G`：光标移动到文件的最后一行
    * `nG` 或 `ngg`：光标移动到文件中的第n行
    * `gg`：光标移动到文件的第一行，等价于 1gg 或 1G
    * `:n<Enter>`   光标跳到第 n 行
    * `n<Enter>`   将光标从当前位置向下移动 n 行

6. **以区块为单位移动**
    * `Ctrl+f`：向下翻一屏
    * `Ctrl+b`：向上翻一屏
    * `Ctrl+u`：向上翻半屏
    * `Ctrl+d`：向下翻半屏
    * `{`：按段移动,上移
    * `}`：按段移动,下移

    > * **数字 + 动作**：可实现更快捷的跳转 => `nh`、`nj`、`nk`、`nl`、`nw`、`ne`、`nb`、`nG`

# 4. 【复制粘贴 & 删除】
1. **复制和粘贴**
    * `p`：粘贴到光标后
    * `P`：粘贴到光标前
    * `y`：复制选中文本
    * `yy`：复制当前行，`nyy`: 复制多行
    * `yw`：复制当前单词
    * `y$`：复制光标到行尾
    * `yfB`：复制光标到第一个大写B中间的内容
    * `y2fB`：复制光标到第二个大写B中间的内容
    * `:3,6 co 12`：复制3-6行，粘贴到第12行下面
    * `:3,6 m 12`：删除3-6行，剪贴到第12行下面
        > * `.`：表示当前行
        > * `$` ：表示最后一行
        > * `+n`：向下的n行
        > * `$-1`：倒数第二行

2. **删除文本**
    * `x`：删除光标后一个字符，`nx`
    * `X`：删除光标前一个字符,  `nX`
    * `dd`：删除当前行，`ndd`
    * `dG`：删除当前行到文件末尾的所有内容
    * `d$`：删除光标到行尾内容
    * `d0`：删除光标到行首内容
    * `dw`：删除当前字符到单词尾（包括空格），`dnw`
    * `de`：删除当前字符到单词尾（不包括空格），`dne`
    * `D`：删除当前位置到行尾的内容
    * `:n1,n2d`   删除指定范围的行

        > * 被删除的内容都放在了剪贴板中。按 "p" 可粘贴

# 5. 【查找替换】
1. **查找文本**
    * `/abc`：从光标位置开始，向下查找字符串 abc
    * `?abc`：从光标位置开始，向上查找字符串 abc
    * `n`：同一方向重复上次的查找指令
    * `N`：向相反方向重复上次的查找指令
    * `/^abc`：查找以 abc 为行首的行
    * `/abc$`：查找以 abc 为行尾的行

2. **替换文本**
    * `r`：替换当前字符
    * `R`：输入内容会覆盖掉后面等长的文本内容，按“Esc”结束
    * `:s/old/new`：将当前行中查找到的第一个字符 “old” 串替换为 “new”
    * `:s/old/new/g`：将当前行中查找到的所有字符串 “old” 替换为 “new”
    * `:#,#s/old/new/g`：在行号“#,#”范围内替换所有的字符串 “old” 为 “new”
    * `:%s/old/new/g`：在整个文件范围内替换所有的字符串 “old” 为 “new”<=> `:1,$s/old/new/g`

    > 替换的分隔符，除了 `/` 还可以使用 `#`，如：`:s#要替换的关键字#替换后的关键字#g`

# 6. 【撤销 & 重复】
* `u`：一步一步撤销
* `U`：取消对当前整行进行的所有操作
* `Ctrl+R`：反撤销
* `.`：重复执行上一次执行的 vi 命令

# 7. 【其他操作】
* `c`：同 `d` 命令，只是删除后进入编辑模式
* `s`：先删除当前光标处字符，再进入编辑状态
* `S`：先删除当前行，在进入编辑状态
* `~`：对光标当前所在的位置的字符进行大小写转换
* `J`：和下一行合并
* `>>`：行右缩进
* `<<`：行左缩进
* `Ctrl + G`：显示文件名、所在行号 以及文件状态信息

***

1. **是否忽略大小写**：`:set ic` 、 `:set noic`
2. **本次搜索忽略大小写**：`/搜索关键字\c`
3. **是否显示行号**：`:set nu` 、 `:set nonu`
4. **是否自动缩进**：`:set ai`、`:set noai`
5. **是否高亮显示查找到的文本**：`:set hlsearch`、`:set nohlsearch`
6. **语法高亮**：`:syntax on`
7. **查看隐藏字符**：`:set list`

# 8. 【可视化模式】

1. `v`：以<mark>字符</mark>为单位来选中文本
    * 按 方向键 来选中需要复制的内容，按 y 键进行复制，按 p 键粘贴

2. `V`：以<mark>行</mark>为单位来选中文本

3. `Ctrl + V`：块模式

    1. **给指定的每行行首添加内容**
        * step1：按 `gg` 切换到第 1 行
        * step2：然后按 `Ctrl + v` 进入到可视化区块模式（列模式）
        * step3：在行首使用上下键选择需要注释的多行
        * step4：按大写 `I` 键，进入插入模式
        * step5：输入要为行首添加的内容，最后连续按两次 Esc 即可

    2. **批量去除注释符号：`#`**
        * step1：按 `gg` 切换到第 1 行
        * step2：按 `Ctrl + v` 进入可视化区块模式（列模式）
        * step3：按方向键选中需要移除的 `#` 号注释
        * step4：直接按 Delete 键即可完成删除注释的操作

# 9. 【分屏操作】
> * `:sp [filename]`：上下分屏
> * `:vsp [filename]`：左右分屏

1. **启动分屏**

    ```bash
    >> vim -On file1 file2 ... # 使用大写O参数进行垂直分屏
    >> vim -on file1 file2 ... # 使用小写o参数进行水平分屏
    # n 是数字，表示分屏的数量，n要大于等于文件个数
    ```

2. **切换分屏**
    * `Ctrl+w,k`：把光标移动到上边的屏
    * `Ctrl+w,j`：把光标移动到下边的屏
    * `Ctrl+w,l`：把光标移动到右边的屏
    * `Ctrl+w,h`：把光标移动到左边的屏
    * `Ctrl+w,w`：把光标移动到下一个的屏

3. **移动分屏**
    * `Ctrl+w,K`：向上移动
    * `Ctrl+w,J`：向下移动
    * `Ctrl+w,L`：向右移动
    * `Ctrl+w,H`：向左移动

4. **屏幕尺寸**
    * `Ctrl+w,[+/-]`：高度变化
    * `Ctrl+w,=`：让所有屏的高度或宽度一致
    * `Ctrl+w,[>/<]`：宽度变化

# 10. 【使用技巧】
1. **导入文件内容到光标处**：`:r 文件名`

2. **不退出vim的情况下执行其他操作**：`:! 命令`
    * 按 `Ctrl + D` 可查看命令可能的补全结果
    * 按 `Tab` 可以使用一个补全

3. **导入命令执行结果**：`:r !命令`

4. **定义快捷键**：`:map 快捷键 触发命令`
    * **在当前行行首添加注释#**：`:map ^P I#<ESC>`  => Ctrl+P：^P 由 Ctrl+v+p 得到
    * **删除当前行行首字符#**：`:map ^B ^x`

5. **连续行注释**
    ```bash
    :n1,n2s/^/#/g
    # "g" 表示执行替换时不询问确认
    # 注释:指定范围的每行行首添加#

    :n1,n2s/^#//g
    # 取消注释: 指定范围内，将每行以#开头的字符#用“”取代

    :n1,n2s/^/\/\//g
    # 添加此种形式: // 的注释
    ```

6. **替换**：`:ab mymail samlee@lampbrother.net`

7. **宏记录**
    * **step1**. 在普通模式中，输入 `qx` 命令，其中 `q` 代表宏记录， `x` 代表给宏起的名，可以是任意字符
    * **step2**. 这时候可以发现，在屏幕左下角会出现 “recording” 字样
    * **step3**. 当编辑修改完成后，接  `Esc`  键回到普通模式，再输入 `q` 命令退出宏记录模式
    * **step4**. 宏记录完成后，就可以执行它了。执行的方法是将光标移动到待编辑的地方，然后执行 `@宏名` 命令即可

# 11. 【vim 配置文件】
* **针对全局用户**： `/etc/vimrc`
* **针对当前用户**： `用户家目录/.vimrc`  => 如果没有则创建它

    ```bash
    set number                    # 显示行号 (set nu)
    syntax on                     # 关键词高亮显示
    set cindent                   # C语法自动缩进 (set ci)
    set autoindent                # 新行自动缩进 (set ai)
    set shiftwidth=4              # 缩进宽度4 (set sw=4)
    set tabstop=4                 # tab键宽度4 (set ts=4)
    set softtabstop=4             # 制表符宽度4 (set st=4)
    set nobackup                  # 不备份 (set nb)
    ```

* **查看所有的设置参数**：`:set all`

//todo
`~/.viminfo` vim 样式设置文件

# 12. 【FAQ】
## 12.1. 【.swp 文件的产生与解决方法】

1. **出现原因**

    1. 文件被多个用户同时使用
    2. 编辑文件时，突然断电，或者突然断网

    ```bash
    >> vi test.txt       # 比如，在没有退出文件前，直接断开远程连接
    >> vi test.txt       # 再次编辑，会报错
        # 此时会生成一个隐藏的临时文件 .test.txt.swp
        # 报错会有提示信息：
        #      [O]pen Read-Only, (E)dit anyway, (R)ecover, (D)elete it, (Q)uit, (A)bort
    ```

2. **vim编辑文件原理**
    1. 开始利用 vim 编辑一个文件
    1. 需要判断编辑的文件所在目录中是否有隐藏文件
        * 拥有: 会有报错提示信息
        * 没有: 进入到命令模式
    1. 在命令模式就会产生临时文件
    1. 进入编辑模式对文件进行编辑
    1. 编辑完成之后需要确定是否正常保存退出
        * 是正常退出: 从编辑状态--esc--命令模式--:wq保存退出 (将临时文件重命名)
        * 非正常退出: 临时文件会永久保留

3. **解决问题方法**
    * **step1**: 进行查看文件内容 => 按大写字母O
    * **step2**: 确认文件是否需要恢复
        * 需要恢复: 重新编辑按 R, 恢复文件内容
        * 不用恢复: 重新编辑按 E, 进行重新编辑
    * **step3**：将临时文件进行删除
        * 按大写字母 D 删除文件
        * 利用 rm 命令删除临时文件
